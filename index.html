<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Klodus Orders</title>
  <style>
    body {font-family: Arial, sans-serif; margin:0; padding:0; background:#0e0f1a; color:#fff;}
    header {padding:15px; background:#171a2c; display:flex; justify-content:space-between; align-items:center;}
    h1 {margin:0; font-size:20px;}
    .btn {padding:8px 14px; border:none; border-radius:6px; cursor:pointer; background:#7c5cff; color:#fff;}
    .btn.secondary {background:#333;}
    .btn.danger {background:#c62828;}
    .card {background:#171a2c; padding:20px; border-radius:8px; margin:20px auto; max-width:1200px;}
    input, select {padding:6px; border-radius:4px; border:1px solid #333; background:#0e0f1a; color:#fff;}
    table {width:100%; border-collapse:collapse; margin-top:10px;}
    th, td {border:1px solid #333; padding:6px; text-align:center;}
    th {background:#222;}
    tr:hover {background:#111;}
    .auth {max-width:400px; margin:40px auto;}
    .field {margin-bottom:12px;}
    .field label {display:block; margin-bottom:4px;}
    .stats {display:flex; gap:10px; margin-top:10px;}
    .stat {background:#222; padding:6px 10px; border-radius:6px;}
    .converter {margin-top:10px; display:flex; gap:10px; align-items:center;}
    img.preview {max-width:80px; max-height:80px; border-radius:4px; cursor:pointer;}
    .imgWrap {display:flex; flex-direction:column; align-items:center; gap:6px;}
    .modal{position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center;}
    .modal.open{display:flex;}
    .modal img{max-width:90vw; max-height:90vh;}
  </style>
</head>
<body>
  <header>
    <h1>Klodus Orders</h1>
    <div id="userBox" style="display:none">
      <span id="userEmail"></span>
      <button id="logoutBtn" class="btn secondary">–í–∏–π—Ç–∏</button>
    </div>
  </header>

  <!-- AUTH -->
  <section id="authSection" class="card auth">
    <h2>–í—Ö—ñ–¥ / –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
    <div class="field"><label>Email</label><input id="authEmail" type="email"></div>
    <div class="field"><label>–ü–∞—Ä–æ–ª—å</label><input id="authPassword" type="password"></div>
    <div class="field"><label>–ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è (–¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó)</label><input id="authPassword2" type="password"></div>
    <div>
      <button id="loginBtn" class="btn">–£–≤—ñ–π—Ç–∏</button>
      <button id="signupBtn" class="btn">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</button>
      <button id="resendBtn" class="btn secondary">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —â–µ —Ä–∞–∑</button>
      <button id="forgotBtn" class="btn secondary">–ó–∞–±—É–ª–∏ –ø–∞—Ä–æ–ª—å?</button>
    </div>
    <div id="recoveryBox" style="display:none; margin-top:14px">
      <h3>–°–∫–∏–¥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—é</h3>
      <div class="field"><label>–ù–æ–≤–∏–π –ø–∞—Ä–æ–ª—å</label><input id="newPwd1" type="password"></div>
      <div class="field"><label>–ü–æ–≤—Ç–æ—Ä—ñ—Ç—å –ø–∞—Ä–æ–ª—å</label><input id="newPwd2" type="password"></div>
      <button id="applyNewPwd" class="btn">–ó–º—ñ–Ω–∏—Ç–∏ –ø–∞—Ä–æ–ª—å</button>
    </div>
  </section>

  <!-- APP -->
  <section id="appSection" style="display:none">
    <div class="card">
      <button id="addRowBtn" class="btn">‚ûï –î–æ–¥–∞—Ç–∏ —Ä—è–¥–æ–∫</button>
      <button id="refreshBtn" class="btn secondary">–û–Ω–æ–≤–∏—Ç–∏</button>
      <select id="monthFilter"></select>
      <input id="defaultMonth" type="text" />
      <div class="stats">
        <div class="stat">–ü—Ä–∏–±—É—Ç–æ–∫: <span id="totalProfit">0</span></div>
        <div class="stat">–¢—Ä–∞—Ç–∏: <span id="totalCosts">0</span></div>
        <div class="stat">–ü—Ä–æ–¥–∞–∂—ñ: <span id="totalSales">0</span></div>
      </div>
      <div class="converter">
        <label>UAH <input id="uahInput" type="number"></label>
        <label>USD <input id="usdInput" type="number"></label>
        <span id="rateInfo">–ö—É—Ä—Å: ...</span>
      </div>
      <table id="ordersTable">
        <thead>
          <tr>
            <th>–ú—ñ—Å—è—Ü—å</th><th>–ü—Ä–æ—Ñ—ñ–ª—å</th><th>Email</th><th>–ü–∞—Ä–æ–ª—å</th><th>–¢–µ–ª–µ—Ñ–æ–Ω</th><th>–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É</th>
            <th>–¶—ñ–Ω–∞ —Ç–æ–≤–∞—Ä—É</th><th>–¶—ñ–Ω–∞ –ø—Ä–æ–≥—Ä—ñ–≤—É</th><th>–¶—ñ–Ω–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</th><th>–¶—ñ–Ω–∞ –ø—Ä–æ–¥–∞–∂—É</th>
            <th>–†–µ—Ñ. —Ç–æ–≤–∞—Ä</th><th>–†–µ—Ñ. –ø—Ä–æ–≥—Ä—ñ–≤</th><th>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è</th><th>–ü—Ä–∏–±—É—Ç–æ–∫</th><th>–î—ñ—è</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <!-- Modal -->
  <div id="imgModal" class="modal"><img id="modalImg"></div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2"

const supabase = createClient(
  "https://nlscfoxagdzuooqrbjgu.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9....", // —Ç–≤—ñ–π anon key
  { auth: { persistSession:true, autoRefreshToken:true, detectSessionInUrl:true } }
)

const authSection=document.getElementById('authSection')
const appSection=document.getElementById('appSection')
const userBox=document.getElementById('userBox')
const userEmailEl=document.getElementById('userEmail')
const tbody=document.querySelector('#ordersTable tbody')
let EXCHANGE_RATE=40

// ==== AUTH ====
async function initAuth(){
  const { data:{user} } = await supabase.auth.getUser()
  setUI(user)
  supabase.auth.onAuthStateChange(async (_,sess)=>setUI(sess?.user))
}
initAuth()
function setUI(user){ 
  if(user){authSection.style.display='none';appSection.style.display='block';userBox.style.display='block';userEmailEl.textContent=user.email; loadOrders();}
  else{authSection.style.display='block';appSection.style.display='none';userBox.style.display='none';tbody.innerHTML=''}
}

// login/register/reset handlers –∞–Ω–∞–ª–æ–≥—ñ—á–Ω—ñ —è–∫ —è –ø–∏—Å–∞–≤ —Ä–∞–Ω—ñ—à–µ...

// ==== LOAD ORDERS ====
async function loadOrders(){ /* —á–∏—Ç–∞–Ω–Ω—è –∑ supabase.orders —ñ –º–∞–ª—é–≤–∞–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—ñ */ }

// ==== SAVE / DELETE / UPDATE ====
function addRow(row){ /* —Ñ–æ—Ä–º—É–≤–∞–Ω–Ω—è —Ä—è–¥–∫–∞, –∞–≤—Ç–æ–ø–µ—Ä–µ—Ä–∞—Ö—É–Ω–æ–∫ —Ü—ñ–Ω, üóë –¥–ª—è –∑–æ–±—Ä–∞–∂–µ–Ω—å */ }

// ==== EXCHANGE RATE ====
async function loadRate(){ try{const r=await fetch("https://bank.gov.ua/NBUStatService/v1/statdirectory/dollar_info");const x=new DOMParser().parseFromString(await r.text(),"text/xml");EXCHANGE_RATE=parseFloat(x.querySelector("rate").textContent);document.getElementById("rateInfo").textContent=`–ö—É—Ä—Å: ${EXCHANGE_RATE}`}catch{}}
loadRate()

</script>
</body>
</html>
